---
import Layout from "../layouts/Layout.astro";
import { wpquery } from "../data/wordpress";
// import TitleAndNav from "../components/TitleAndNav";
import ProgramList from "../components/ProgramList";
import NextStepFooter from "../components/NextStepFooter";
import "@fontsource/domine/400.css";
import "@fontsource/domine/500.css";
import "@fontsource/domine/600.css";
import "@fontsource/domine/700.css";
import IntroSection from "../components/IntroSection";
// import "../styles/homepage.scss";
const data = await wpquery({
  query: ` query ProgramsListing {
              programs(first:220) {
                nodes {
                  program {
                    degreeType
                    slug
                    school
                    programOptions
                    additionalOptions
                    keywords
                  }
                  title
                }
              }
            }`,
});
const redirectData = await wpquery({
  query: `query RedirectList {
            programRedirects(first:220) {
              nodes {
                  redirectProgram {
                    degreeType
                    redirecturl
                    slug
                    school
                    programOptions
                    additionalOptions
                    keywords
                  }
                  title
                }
            }
          }`,
});

// console.log(data.programs.nodes);
// console.log(redirectData.programRedirects.nodes);
const programOptions = await wpquery({
  query: ` query FullOptionsListing {
  page(id: "249", idType: DATABASE_ID) {
    program {
      additionalOptions
      programOptions
      school
    }
  }
}`,
});
// console.log(programOptions);
// console.log(data);
// console.log(data.programs.program);
// console.log(JSON.stringify(data.programs.nodes, null, 2)); // Log the entire list
// console.log(JSON.stringify(programOptions.page.program, null, 2)); // Log the entire list

const areaOfStudy = programOptions.page.program.school.sort();
// console.log(areaOfStudy);
const areaOfStudyNoGrad = areaOfStudy.filter(
  (item: string) => item !== "Graduate, Global, and Online Education"
);
const programOptionsClean = programOptions.page.program.programOptions;
// console.log(programOptionsClean);
const additionalOptions = programOptions.page.program.additionalOptions;
// console.log(additionalOptions);
// const combinedData = {
//   ...data,
//   ...redirectData,
// };
// console.log(data);
// console.log(combinedData.programs.nodes);
// console.log(redirectData.programRedirects.nodes);
// console.log(areaOfStudyNoGrad);

// STRUCTURED DATA START
const combinedData = data.programs.nodes.concat(
  redirectData.programRedirects.nodes.map(
    (item: { redirectProgram: any; title: any }) => ({
      program: item.redirectProgram,
      title: item.title,
    })
  )
);
// console.log(combinedData.length);
const programListSchema = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  itemListElement: combinedData.map(
    (
      program: {
        title: any;
        program: { description: any; school: any[]; slug: any; keywords: any };
      },
      index: number
    ) => ({
      "@type": "ListItem",
      position: index + 1,
      item: {
        "@type": "EducationalOccupationalProgram", // This is the correct type for educational programs
        name: program.title,
        description: program.program.description || "",
        provider: {
          "@type": "CollegeOrUniversity", // More specific than EducationalOrganization
          name: "The College of New Jersey", // Your school name
          department: Array.isArray(program.program.school)
            ? program.program.school.join(", ")
            : program.program.school,
        },

        url: `https://programs.tcnj.edu/${program.program.slug}`, // Update with your actual URL pattern
        keywords: program.program.keywords || "",
      },
    })
  ),
};

const schemaString = JSON.stringify(programListSchema);
---

<Layout title="160+ Undergraduate Programs | TCNJ">
  <script type="application/ld+json" set:html={schemaString} />

  <header>
    <!-- <TitleAndNav /> -->
    <IntroSection client:load />
    <!-- <Intro /> -->
  </header>
  <main>
    <div
      class="border-[20px] sm:border-[35px] border-t-0 sm:border-t-0 border-tcnjyellow"
    >
      <ProgramList
        data={data}
        redirectData={redirectData}
        areaOfStudy={areaOfStudyNoGrad}
        programOptionsClean={programOptionsClean}
        additionalOptions={additionalOptions}
        client:visible
      />
    </div>
    <NextStepFooter />
  </main>
</Layout>
